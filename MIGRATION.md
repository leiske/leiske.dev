# Migration to TanStack Start

## Overview

This document describes the migration of leiske.dev from a custom static site generator to TanStack Start framework.

**Migration Date:** January 3, 2026

## What Was Changed

### Framework & Architecture

- **Before:** Custom static site generator using `ReactDOMServer.renderToStaticMarkup` with client-side routing
- **After:** TanStack Start 1.145.3 with TanStack Router for file-based routing and server-side rendering

### Build Process

- **Before:** Custom build script in `scripts/build-static.ts` with TypeScript compilation
- **After:** Vite-based build via `npm run build` integrated with TanStack Start

### Routing

- **Before:** Client-side routing via `window.location.pathname`
- **After:** TanStack Router file-based routing with `src/routes/` directory structure

### Markdown Processing

- **Before:** `marked` library for markdown parsing
- **After:** Unified ecosystem (remark/rehype) for advanced markdown processing with syntax highlighting

### Content Management

- **Before:** Custom post processing utilities in `src/lib/posts.ts`
- **After:** @content-collections for build-time markdown processing with type safety

### Styling

- **Before:** Tailwind CSS with PostCSS configuration
- **After:** Tailwind CSS v4 with @import-based configuration via `@tailwindcss/vite`

## Dependencies Removed

### Removed Libraries
- `marked` - Replaced with unified ecosystem
- `@vitejs/plugin-react` - Replaced by TanStack Start's built-in React handling

### Removed Files
- `scripts/build-static.ts` - Custom build script
- `src/lib/posts.ts` - Post processing utilities
- `src/lib/__tests__/` - Old test directory
- `src/pages/` directory - Old page components (Home.tsx, BlogPost.tsx, NotFound.tsx)
- `.github/workflows/deploy.yml` - GitHub Pages deployment workflow

## Dependencies Added

### TanStack Stack
- `@tanstack/react-start` 1.145.3 - Main framework
- `@tanstack/react-router` 1.144.0 - File-based routing

### Content Collections
- `@content-collections/core` 0.13.0 - Build-time content processing
- `@content-collections/vite` 0.2.8 - Vite integration
- `zod` 4.3.4 - Schema validation

### Markdown Processing (Unified Ecosystem)
- `unified` 11.0.5 - Core processor
- `remark-parse` 11.0.0 - Markdown parser
- `remark-gfm` 4.0.1 - GitHub Flavored Markdown
- `remark-rehype` 11.1.2 - Markdown to HTML transformer
- `rehype-raw` 7.0.0 - Raw HTML support
- `rehype-slug` 6.0.0 - Heading IDs for anchors
- `rehype-autolink-headings` 7.1.0 - Auto-link headings
- `rehype-stringify` 10.0.1 - HTML serializer
- `html-react-parser` 5.2.11 - HTML to React parser
- `shiki` 3.20.0 - Syntax highlighting
- `unist-util-visit` 5.0.0 - AST traversal
- `hast-util-to-string` 3.0.1 - AST to string converter

### SEO
- `@corentints/tanstack-router-sitemap` 1.0.1 - Automatic sitemap generation

### Styling
- `@tailwindcss/vite` 4.1.18 - Tailwind v4 plugin
- `@tailwindcss/typography` 0.5.19 - Typography plugin

## New File Structure

```
src/
├── components/
│   ├── Markdown.tsx          # NEW: Markdown renderer with unified
│   ├── PostContent.tsx       # UPDATED: Uses Link component
│   └── PostList.tsx         # UPDATED: Uses Link component
├── routes/                   # NEW: File-based routing
│   ├── __root.tsx           # NEW: Root layout
│   ├── index.tsx            # NEW: Home page
│   ├── blog.index.tsx        # NEW: Blog index
│   └── blog.$slug.tsx       # NEW: Blog post page
├── styles/
│   └── app.css              # NEW: @import 'tailwindcss'
├── types/
│   └── post.ts              # UPDATED: Imports from content-collections
├── utils/
│   └── markdown.ts          # NEW: Unified processing pipeline
├── main.tsx                # UPDATED: Router configuration
└── router.tsx              # NEW: Route tree setup

content-collections.ts        # NEW: Content configuration
vite.config.ts              # UPDATED: TanStack Start plugins
```

## Updated Files

### Configuration Files
- `vite.config.ts` - Added TanStack Start, content-collections, and sitemap plugins
- `tsconfig.app.json` - Added path aliases for content-collections and vitest types
- `package.json` - Updated scripts and dependencies

### Application Files
- `src/main.tsx` - RouterProvider with TanStack Router
- `src/components/PostList.tsx` - Uses TanStack Router Link
- `src/components/PostContent.tsx` - Uses TanStack Router Link, Markdown component
- `src/types/post.ts` - Imports Post type from content-collections

### Documentation
- `README.md` - Complete rewrite with TanStack Start documentation
- `AGENTS.md` - Updated development commands and conventions

### SEO Files
- `public/sitemap.xml` - Auto-generated by build
- `public/robots.txt` - Created with sitemap reference

## Breaking Changes

### Build Command
- **Old:** Custom build script or manual steps
- **New:** `npm run build` (Vite-based)

### Server Entry Point
- **Old:** Various static HTML files
- **New:** `dist/server/server.js` (Node.js server)

### Route URLs
- **Old:** Custom routing logic
- **New:** TanStack Router file-based routing (`src/routes/`)

### Type Imports
- **Old:** Local type definitions
- **New:** Types imported from `content-collections` path alias

### Import Extensions
- **Old:** Mixed extensions (.js, .ts, .tsx)
- **New:** Must use explicit file extensions for all imports

### Content Type
- **Old:** Post type from `src/types/post.ts`
- **New:** Post type from `content-collections` (generated automatically)

## Migration Benefits

### Performance
- Server-side rendering for better initial load times
- Optimized bundle sizes via TanStack Start
- Content generation at build time (not runtime)

### Developer Experience
- Type-safe routing with TanStack Router
- File-based routing for intuitive structure
- Auto-generated route tree
- Content collections with schema validation

### SEO
- Proper meta tags for all pages
- Open Graph tags for social sharing
- Twitter card support
- JSON-LD structured data for blog posts
- Automatic sitemap generation
- Canonical URLs

### Maintenability
- Reduced custom code (fewer utilities)
- Well-documented framework patterns
- Community-supported ecosystem
- Better testability

## Post-Migration Tasks

All tasks from the migration plan have been completed:
- ✅ Framework migration to TanStack Start
- ✅ Content collections setup
- ✅ Tailwind CSS v4 integration
- ✅ File-based routing implementation
- ✅ SEO meta tags and structured data
- ✅ Sitemap and robots.txt generation
- ✅ Component updates
- ✅ Testing verification
- ✅ Documentation updates
- ✅ Build and linting verification

## Notes for Future Development

### Adding New Routes
- Create `.tsx` files in `src/routes/`
- Use naming conventions: `index.tsx`, `blog.index.tsx`, `blog.$slug.tsx`
- TanStack Start auto-generates route tree on dev server restart

### Adding Blog Posts
- Create `.md` files in `posts/` directory
- Include required frontmatter fields: date, title, slug, description, tags
- Optional `test: true` field excludes post from production
- Content collections auto-processes and types the posts

### SEO Considerations
- Add `head` function to routes for meta tags
- Use Open Graph and Twitter Card tags
- Include canonical URLs
- Sitemap auto-updates on build

### Build Process
- Run `npm run build` for production builds
- Output goes to `dist/` directory (client and server)
- Start production server with `npm run start`

## Conclusion

The migration to TanStack Start has been completed successfully. The application now benefits from modern SSR/SSG capabilities, better SEO, improved developer experience, and a more maintainable codebase.
